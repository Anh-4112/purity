{{ 'section-parallax-image.css' | asset_url | stylesheet_tag }}
{%- liquid
  assign section_st = section.settings
  if section_st.section_width == 'fix_width'
    assign section_width = 'container'
  elsif section_st.section_width == 'full_width'
    assign section_width = 'full-width px-20'
  else
    assign section_width = 'fluid_container'
  endif
  assign column_gap_slide = section_st.column_gap
  if section_st.column_gap == 'large'
    assign column_gap_slide = 30
  elsif section_st.column_gap == 'medium'
    assign column_gap_slide = 20
  elsif section_st.column_gap == 'small'
    assign column_gap_slide = 10
  endif
  assign heading_size = section_st.heading_size
  assign header_size = ''
  if heading_size == 'small'
    assign header_size = 'h3'
  elsif heading_size == 'large'
    assign header_size = 'h1'
  endif

  assign radius_image_class = ''
  assign radius_content_class = ''
  assign has_custom_background = false
  if section_st.background_color != 'rgba(0,0,0,0)' and section_st.background_color != 'transparent' and section_st.background_color != blank and section_st.background_color != '#fff' and section_st.background_color != '#ffffff'
    assign has_custom_background = true
  endif
  if column_gap_slide == 0 and has_custom_background
    if section_st.image_desktop_position == 'left'
      assign radius_image_class = 'rounded-1025-left rounded-top-mb'
      assign radius_content_class = 'rounded-1025-right rounded-bottom-mb'
    else
      assign radius_image_class = 'rounded-1025-right rounded-top-mb'
      assign radius_content_class = 'rounded-1025-left rounded-bottom-mb'
    endif
  else
    assign radius_image_class = 'rounded'
    assign radius_content_class = 'rounded'
  endif
  if has_custom_background
    assign padding_content_class = 'p-30'
  else
    if column_gap_slide != 0
      assign padding_content_class = ''
    else
      assign padding_content_class = 'image-with-text__container'
    endif
  endif
-%}
{%- capture style -%}
    --section-pt: {{ section_st.padding_top }}; --section-pb: {{ section_st.padding_bottom }};
    {% if heading_size == 'large' %}--font-size: 40;{% endif %}
  {%- endcapture -%}
{%- capture col_style -%}
    {% if column_gap_slide < 15 %}--gap: {{ column_gap_slide }}px;--gap: {{ column_gap_slide }}px;{% else %}--gap: 15px;--gap: {{  column_gap_slide }}px;--gap-desktop: {{  column_gap_slide }}px;{% endif %}
  {%- endcapture -%}
<div
  class="section color-{{ section_st.color_scheme }}"
  style="{{ style | strip | strip_newlines }}"
>
  <div
    class="{{ section_width }}"
  >
    {%- if section_st.title != blank or section_st.description != blank or section_st.subheading != blank -%}
      <div
        class="section-header text-{{ section_st.header_alignment }}{% if section.blocks.size > 0 %} mb-30 mb-md-40{% endif %}"
      >
        {%- if section_st.subheading != blank -%}
          <div class="section-subheading h7 mb-5 mb-md-10 subheading_weight fs-big-2">
            {{ section_st.subheading }}
          </div>
        {%- endif -%}
        {%- if section_st.title != blank -%}
          <h2 class="block section-heading {{ header_size }}">
            {{ section_st.title }}
          </h2>
        {%- endif -%}
        {%- if section_st.description != blank -%}
          <div class="section-description mt-15">
            {{ section_st.description }}
          </div>
        {%- endif -%}
      </div>
    {%- endif -%}

    <parallax-image>
      <div
        class="parallax-wrapper flex wrap gap{% if section_st.image_desktop_position == 'right' %} row-reverse-md{% endif %}"
        style="{{ col_style | strip | strip_newlines }}"
      >
        <div class="parallax-media w-full col-1025-w-custom">
          {%- for block in section.blocks -%}
            {%- liquid
              assign block_st = block.settings
              assign image_ratio = section_st.image_ratio
              assign ratio = '3/4'
              if image_ratio != 'adapt'
                case image_ratio
                  when 'square'
                    assign ratio = '1/1'
                  when 'landscape'
                    assign ratio = '4/3'
                  when 'portrait'
                    assign ratio = '3/4'
                endcase
              else
                if block_st.video != blank
                  assign ratio = block_st.video.aspect_ratio
                elsif block_st.image != blank
                  assign ratio = block_st.image.aspect_ratio
                else
                  assign ratio = '3/4'
                endif
              endif
            -%}
            <div
              class="image-with-text__media banner__media image-slide {{ radius_image_class }} {% if forloop.first %}active{% endif %}"
              data-index="{{ forloop.index }}"
              style="--aspect-ratio: {{ ratio }};"
            >
              {%- liquid
                assign alt = 'general.image.image_alt_default' | t
                if block_st.image.alt
                  assign alt = block_st.image.alt | escape
                endif
              -%}
              {% if block_st.video != blank %}
                {%- liquid
                  assign source = block_st.video.sources
                  assign source_url = ''
                  for s in source
                    if s.format == 'mp4'
                      assign source_url = s.url
                      break
                    endif
                  endfor
                  assign video_poster = block_st.video.preview_image | image_url: width: 1100
                -%}
                <video-local>
                  <video
                    loop="true"
                    data-src="{{ source_url }}"
                    poster="{{ video_poster }}"
                    playsinline="true"
                    autoplay
                    muted
                  ></video>
                </video-local>
              {% elsif block_st.image != blank %}
                {% render 'responsive-image',
                  type: 'other',
                  container: section_width,
                  image: block_st.image,
                  image_alt: alt,
                  padding: column_gap_slide
                %}
              {% else %}
                {% render 'placeholder-render', type: 'collection-6', class: 'img-placeholder h-full w-full' %}
              {% endif %}
            </div>
          {%- endfor -%}
        </div>
        <div class="w-full parallax-content col-1025-remaining flex text-{{ section_st.content_alignment }}">
          <div class="scrollable-content custom-scrollbar">
            {%- for block in section.blocks -%}
              {% assign block_st = block.settings %}
              {% if has_custom_background %}
                <div
                  class="w-full text-section flex bg-custom {{ radius_content_class }} {% if forloop.first %}active{% endif %}"
                  style="--bg-color-custom: {{ section_st.background_color }};"
                  data-index="{{ forloop.index }}"
                >
              {% endif %}
              <div class="image-with-text__text-item-inner w-full align-self-{{ section_st.desktop_vertical_alignment }} {{ padding_content_class }} text-{{ section_st.text_alignment_mobile }} text-md-{{ section_st.text_alignment }}">
                {%- if block_st.subheading != blank -%}
                  <div class="section-subheading h7 mb-5 mb-md-10 subheading_weight fs-big-2">
                    {{ block_st.subheading }}
                  </div>
                {%- endif -%}
                {%- if block_st.heading != blank -%}
                  <h2 class="block section-heading {{ header_size }}">
                    {{ block_st.heading }}
                  </h2>
                {%- endif -%}
                {%- if block_st.description != blank -%}
                  <div class="section-description mt-15">
                    {{ block_st.description }}
                  </div>
                {%- endif -%}
              </div>
              {% if has_custom_background %}</div>{% endif %}
            {%- endfor -%}
          </div>
        </div>
      </div>
    </parallax-image>
  </div>
</div>

{% schema %}
{
  "name": "t:sections.parallax-image.name",
  "class": "section section-image-card",
  "disabled_on": {
    "groups": ["header", "footer", "custom.overlay"]
  },
  "settings": [
    {
      "type": "header",
      "content": "t:sections.all.general"
    },
    {
      "type": "select",
      "id": "section_width",
      "options": [
        {
          "value": "fix_width",
          "label": "t:sections.all.layout.fix_width"
        },
        {
          "value": "stretch_width",
          "label": "t:sections.all.layout.stretch_width"
        },
        {
          "value": "full_width",
          "label": "t:sections.all.layout.full_width"
        }
      ],
      "default": "fix_width",
      "label": "t:sections.all.layout.label"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "info": "t:sections.all.colors.info",
      "default": "default-color-scheme"
    },
    {
      "type": "header",
      "content": "t:sections.all.content_header.label"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "t:sections.all.content_setting.subheading.label",
      "default": "Sale Up to 75% Off"
    },
    {
      "type": "text",
      "id": "title",
      "default": "Today's Best Deals",
      "label": "t:sections.all.content_setting.heading.label"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "t:sections.all.content_setting.description.label"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "small",
          "label": "t:sections.all.content_header.heading_size.options__1.label"
        },
        {
          "value": "medium",
          "label": "t:sections.all.content_header.heading_size.options__2.label"
        },
        {
          "value": "large",
          "label": "t:sections.all.content_header.heading_size.options__3.label"
        }
      ],
      "default": "medium",
      "label": "t:sections.all.content_header.heading_size.label"
    },
    {
      "type": "select",
      "id": "header_alignment",
      "options": [
        {
          "value": "start",
          "label": "t:sections.all.text_alignment.options__1.label"
        },
        {
          "value": "center",
          "label": "t:sections.all.text_alignment.options__2.label"
        },
        {
          "value": "end",
          "label": "t:sections.all.text_alignment.options__3.label"
        }
      ],
      "default": "center",
      "label": "t:sections.all.text_alignment.alignment"
    },
    {
      "type": "select",
      "id": "column_gap",
      "options": [
        {
          "value": "no_gap",
          "label": "t:sections.all.padding.column_gap.no_gap"
        },
        {
          "value": "small",
          "label": "t:sections.all.padding.column_gap.small"
        },
        {
          "value": "medium",
          "label": "t:sections.all.padding.column_gap.medium"
        },
        {
          "value": "large",
          "label": "t:sections.all.padding.column_gap.large"
        }
      ],
      "default": "medium",
      "label": "t:sections.all.padding.column_gap.label"
    },
    {
      "type": "header",
      "content": "t:sections.parallax-image.blocks.settings.header.media"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "t:sections.all.image.aspect_ratio.adapt"
        },
        {
          "value": "square",
          "label": "t:sections.all.image.aspect_ratio.options__1"
        },
        {
          "value": "portrait",
          "label": "t:sections.all.image.aspect_ratio.options__2"
        },
        {
          "value": "landscape",
          "label": "t:sections.all.image.aspect_ratio.options__3"
        }
      ],
      "default": "adapt",
      "label": "t:sections.all.image.aspect_ratio.label"
    },
    {
      "type": "select",
      "id": "image_desktop_position",
      "options": [
        {
          "value": "left",
          "label": "t:sections.all.image.desktop_position.left"
        },
        {
          "value": "right",
          "label": "t:sections.all.image.desktop_position.right"
        }
      ],
      "default": "left",
      "label": "t:sections.all.image.desktop_position.label",
      "info": "t:sections.all.image.desktop_position.info"
    },
    {
      "type": "header",
      "content": "t:sections.all.content_setting.label"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "t:sections.image-with-text.settings.background_color",
      "default": "#ECE7DA"
    },
    {
      "type": "select",
      "id": "desktop_vertical_alignment",
      "options": [
        {
          "value": "start",
          "label": "t:sections.image-with-text.settings.desktop_vertical_alignment.top"
        },
        {
          "value": "center",
          "label": "t:sections.image-with-text.settings.desktop_vertical_alignment.middle"
        },
        {
          "value": "end",
          "label": "t:sections.image-with-text.settings.desktop_vertical_alignment.bottom"
        }
      ],
      "default": "end",
      "label": "t:sections.image-with-text.settings.desktop_vertical_alignment.label"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "options": [
        {
          "value": "start",
          "label": "t:sections.all.text_alignment.options__1.label"
        },
        {
          "value": "center",
          "label": "t:sections.all.text_alignment.options__2.label"
        },
        {
          "value": "end",
          "label": "t:sections.all.text_alignment.options__3.label"
        }
      ],
      "default": "start",
      "label": "t:sections.all.text_alignment.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.mobile_options.label"
    },
    {
      "type": "select",
      "id": "text_alignment_mobile",
      "options": [
        {
          "value": "start",
          "label": "t:sections.all.text_alignment.options__1.label"
        },
        {
          "value": "center",
          "label": "t:sections.all.text_alignment.options__2.label"
        },
        {
          "value": "end",
          "label": "t:sections.all.text_alignment.options__3.label"
        }
      ],
      "default": "start",
      "label": "t:sections.all.text_alignment.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 48
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 48
    }
  ],
  "blocks": [
    {
      "type": "media",
      "name": "t:sections.parallax-image.blocks.name",
      "limit": 4,
      "settings": [
        {
          "type": "header",
          "content": "t:sections.parallax-image.blocks.settings.header.media"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:sections.all.image.label"
        },
        {
          "type": "video",
          "id": "video",
          "label": "t:sections.video.settings.video_local.label"
        },
        {
          "type": "header",
          "content": "t:sections.all.content_setting.label"
        },
        {
          "type": "select",
          "id": "icon_svg",
          "label": "t:sections.all.svg.label",
          "info": "t:sections.all.svg.custom_svg.info",
          "default": "none",
          "options": [
            {
              "value": "none",
              "label": "t:sections.all.icon.none.label"
            },
            {
              "value": "leaf",
              "label": "t:sections.all.icon.leaf.label"
            },
            {
              "value": "cruelty",
              "label": "t:sections.all.icon.cruelty.label"
            },
            {
              "value": "paraben",
              "label": "t:sections.all.icon.paraben.label"
            },
            {
              "value": "check_badge",
              "label": "t:sections.all.icon.check_badge.label"
            },
            {
              "value": "free_shipping",
              "label": "t:sections.all.icon.free_shipping.label"
            },
            {
              "value": "message_communications",
              "label": "t:sections.all.icon.message_communications.label"
            }
          ]
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "t:sections.all.content_setting.subheading.label"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "t:sections.all.content_setting.heading.label"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "t:sections.all.content_setting.description.label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.parallax-image.name"
    }
  ]
}
{% endschema %}
