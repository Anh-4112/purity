{% liquid
  assign section_st = section.settings
  assign items_per_row = section_st.items_per_row
  assign show_navigation = section_st.show_navigation
  assign reveal_slide = section_st.reveal_slide
  assign items_per_row_mobile = section_st.items_per_row_mobile

  assign items_per_row_tablet = items_per_row
  if items_per_row > 3
    assign items_per_row_tablet = items_per_row | minus: 1
  endif

  assign column_gap_slide = 0
  if section_st.column_gap == 'large'
    assign column_gap_slide = 30
  elsif section_st.column_gap == 'medium'
    assign column_gap_slide = 20
  elsif section_st.column_gap == 'small'
    assign column_gap_slide = 10
  endif
%}
{% style %}
  close-to-offer {
    top: -2.5rem;
    left: 50%;
    transform: translateX(-50%);
  }
  close-to-offer svg {
    rotate: 180deg;
  }
  .offer-wrapper::after {
    content: '';
    background: #0006;
    min-height: 100lvh;
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 10;
  }
  .offer-wrapper,
  .offer-content {
    z-index: 99;
  }
  .offer-wrapper {
    bottom: 0;
    left: 0;
    right: 0;
  }
  scroll-offer {
    position: fixed;
    bottom: 3rem;
    left: 3rem;
    z-index: 10;
    --btn-radius: 3rem;
  }
  icon-close-offer {
    width: 2.6rem;
    height: 2.6rem;
    top: -1.8rem;
    z-index: 99;
  }
  .padding-block {
    padding: 1.5rem 3rem;
  }
{% endstyle %}

<scroll-offer class="block" style="opacity: 0;">
  <div
    class="subheading_weight pointer lh-normal inline-flex align-center {% if section_st.uppercase %} uppercase{% endif %} fs-{{ section_st.highlight_text_size }} text-color bg-custom{% if section_st.background_color != "rgba(0,0,0,0)" and section_st.background_color != "transparent" and section_st.background_color != blank  %} padding-block btn-rounded{% endif %}"
    style="--color-text: {{ section_st.text_color }};--bg-color-custom: {{ section_st.background_color }};"
  >
    {%- if section_st.highlight_text_icon == 'star' -%}
      {%- render 'icon-star' -%}
    {%- elsif section_st.highlight_text_icon == 'dot' -%}
      {%- render 'icon-dot' -%}
    {%- elsif section_st.highlight_text_icon == 'discount' -%}
      {%- render 'icon-discount' -%}
    {%- endif -%}
    {{ section_st.highlight_text | escape }}
  </div>
  <icon-close-offer class="absolute pointer shadow border inline-flex mx-auto rounded-50 overflow-hidden content-center heading-color bg-white">
    <svg width="8" height="8" viewBox="0 0 13 14" fill="none">
      <use href="#icon-close" />
    </svg>
  </icon-close-offer>
</scroll-offer>
<template>
  <div class="offer-wrapper fixed">
    <div
      class="offer-content relative full-width px-30 py-30 {% if reveal_slide %} overflow-hidden{% endif %}"
      style="background-color: {{ section_st.background_section }}"
    >
      <modal-overlay class="modal-overlay pointer invisible transition"></modal-overlay>
      <close-to-offer
        class="close-to-offer absolute transition pointer w-50 h-50 inline-flex content-center bg-white rounded-50 overflow-hidden"
      >
        <svg width="8" height="10" fill="none" class="color-black">
          <path fill="currentColor" d="M7.797 4.203h.016A.636.636 0 0 1 8 4.672a.67.67 0 0 1-.188.469.69.69 0 0 1-.484.187.67.67 0 0 1-.469-.187L4 2.28l-2.86 2.86a.69.69 0 0 1-.484.187.617.617 0 0 1-.453-.187A.644.644 0 0 1 0 4.67c0-.187.068-.343.203-.468L3.531.86A.636.636 0 0 1 4 .672c.188 0 .344.062.469.187l3.328 3.344Zm0 4.656h.016A.69.69 0 0 1 8 9.344a.617.617 0 0 1-.188.453.661.661 0 0 1-.953 0L4 6.937l-2.86 2.86A.661.661 0 0 1 .657 10a.594.594 0 0 1-.453-.203A.594.594 0 0 1 0 9.344c0-.188.068-.35.203-.485l3.328-3.328A.611.611 0 0 1 4 5.328c.188 0 .344.068.469.203L7.797 8.86Z"></path>
        </svg>
      </close-to-offer>
      <slide-section
        class="swiper{% if reveal_slide %} reveal_on_scroll{% endif %}"
        data-section-id="{{ section.id }}"
        data-autoplay="false"
        data-effect="slide"
        data-loop="false"
        data-speed="500"
        data-spacing="{{ column_gap_slide }}"
        data-mobile="{{ items_per_row_mobile }}"
        data-desktop="{{ items_per_row }}"
        data-tablet="{{ items_per_row_tablet }}"
        data-free-mode="true"
      >
        {% if show_navigation %}
          {%- render 'swiper-navigation' -%}
        {% endif %}
        <div class="swiper-wrapper">
          {% content_for 'blocks' %}
        </div>
      </slide-section>
    </div>
  </div>
</template>

{% schema %}
{
  "name": "t:sections.offers-popup.name",
  "tag": "section",
  "class": "section section-offers-popup",
  "limit": 1,
  "max_blocks": 10,
  "enabled_on": {
    "groups": ["custom.overlay"]
  },
  "settings": [
    {
      "type": "header",
      "content": "t:sections.all.general"
    },
    {
      "type": "color",
      "id": "background_section",
      "label": "t:sections.image-with-text.settings.background_color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "items_per_row",
      "label": "t:sections.all.columns_desktop.label",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 3
    },
    {
      "type": "select",
      "id": "column_gap",
      "options": [
        {
          "value": "no_gap",
          "label": "t:sections.all.padding.column_gap.no_gap"
        },
        {
          "value": "small",
          "label": "t:sections.all.padding.column_gap.small"
        },
        {
          "value": "medium",
          "label": "t:sections.all.padding.column_gap.medium"
        },
        {
          "value": "large",
          "label": "t:sections.all.padding.column_gap.large"
        }
      ],
      "default": "medium",
      "label": "t:sections.all.padding.column_gap.label"
    },
    {
      "type": "checkbox",
      "id": "show_navigation",
      "default": true,
      "label": "t:sections.all.carousel.show_navigation.label"
    },
    {
      "type": "checkbox",
      "id": "reveal_slide",
      "default": false,
      "label": "t:sections.all.carousel.reveal_slide.label"
    },
    {
      "type": "range",
      "id": "items_per_row_mobile",
      "label": "t:sections.all.items.items_per_row_mobile",
      "min": 1,
      "max": 2,
      "step": 0.5,
      "default": 1
    },
    {
      "type": "header",
      "content": "t:sections.all.content_setting.label"
    },
    {
      "type": "select",
      "id": "column_gap_block",
      "options": [
        {
          "value": "no_gap",
          "label": "t:sections.all.padding.column_gap.no_gap"
        },
        {
          "value": "small",
          "label": "t:sections.all.padding.column_gap.small"
        },
        {
          "value": "medium",
          "label": "t:sections.all.padding.column_gap.medium"
        },
        {
          "value": "large",
          "label": "t:sections.all.padding.column_gap.large"
        }
      ],
      "default": "medium",
      "label": "t:sections.all.padding.column_gap.label"
    },
    {
      "type": "text",
      "id": "highlight_text",
      "default": "Highlight text",
      "label": "t:sections.multi_content.blocks.badge"
    },
    {
      "type": "select",
      "id": "highlight_text_icon",
      "options": [
        {
          "value": "none",
          "label": "t:sections.all.content_setting.highlight_text.settings.icons.options__1.label"
        },
        {
          "value": "star",
          "label": "t:sections.all.content_setting.highlight_text.settings.icons.options__2.label"
        },
        {
          "value": "dot",
          "label": "t:sections.all.content_setting.highlight_text.settings.icons.options__3.label"
        },
        {
          "value": "discount",
          "label": "t:sections.all.content_setting.highlight_text.settings.icons.options__4.label"
        }
      ],
      "default": "discount",
      "label": "t:sections.all.content_setting.highlight_text.settings.icons.label"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "t:sections.image-with-text.settings.background_color",
      "default": "#D0473E"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "t:sections.image-with-text.settings.text_color",
      "default": "#ffffff"
    }
  ],
  "blocks": [
    {
      "type": "group-image-with-text-offer"
    }
  ],
  "presets": [
    {
      "name": "t:sections.offers-popup.name"
    }
  ]
}
{% endschema %}
