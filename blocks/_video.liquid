{% liquid
  assign section_st = section.settings
  assign block_st = block.settings
  assign video_local = block_st.video_local
  assign poster = block_st.cover_image | default: block_st.video_local.preview_image | image_url: width: 1100
  assign video_id = block_st.video_id | default: block_st.video_url.id
  assign autoplay = false
  assign loop = false
  assign muted = false
  if block_st.autoplay
    assign autoplay = true
    assign muted = true
  endif
  if block_st.looping
    assign loop = true
  endif
%}

{%- style -%}
  #shopify-block-{{ block.id }} {
    --col-width: {{ block_st.width }};
  }
{%- endstyle -%}

<div class="multi-content__block w-full h-full flex align-{{ block_st.vertical_alignment }}">
  <video-local
    class="w-full video-section relative{% if section_st.equal_height_adjustment %} h-full{% endif %} rounded"
  >
    <div
      class="video-has-bg block video-section relative z-3{% if section_st.equal_height_adjustment %} h-full{% endif %}"
      style="
        {%- if block_st.video_local != null -%}
          {% if block_st.aspect_ratio != 'adapt' %}--aspect-ratio: {{ block_st.aspect_ratio }}{% else %}--aspect-ratio: {{ block_st.video_local.aspect_ratio }}{% endif %}
        {%- endif -%}
        {%- if block_st.video_local == null -%}
          {%- if block_st.aspect_ratio != 'adapt' -%}--aspect-ratio: {{ block_st.aspect_ratio }}{%- else -%}--aspect-ratio: 16/9{%- endif -%}
         {%- endif -%}
      "
    >
      {%- if block_st.video_local == null and block_st.video_url != null -%}
        {% liquid
          if block_st.video_url.type == 'youtube'
            assign video_base_url = 'https://www.youtube.com/embed/'
            assign video_class = 'js-youtube w-full h-full'
            assign mute_param = 'mute'
          else
            assign video_base_url = 'https://player.vimeo.com/video/'
            assign video_class = 'js-vimeo vimeo-video bg-dark w-full h-full'
            assign mute_param = 'muted'
          endif
        %}
        <iframe
          src="{{ video_base_url }}{{ video_id }}?autoplay={% if block_st.autoplay %}1{% else %}0{% endif %}&loop={% if block_st.looping %}1{% else %}0{% endif %}&{{ mute_param }}={% if block_st.autoplay %}1{% else %}0{% endif %}&playsinline=1"
          class="{{ video_class }}"
          allow="autoplay; encrypted-media"
          allowfullscreen
          frameborder="0"
          title="{{ 'accessibility.video' | t }}"
          aria-label="{{ 'accessibility.video' | t }}"
        ></iframe>

      {%- else -%}
        {% liquid
          assign poster = block_st.video_local.preview_image
          assign image_alt_default = 'general.image.image_alt_default' | t
        %}
        <div
          class="video-thumbnail z-2 absolute banner__media overflow-hidden"
        >
          {%- if poster != null -%}
            {% render 'responsive-image', type: 'other', image: poster, image_alt: image_alt_default %}
          {%- else -%}
            {%- render 'placeholder-render', type: 'lifestyle-1' -%}
          {%- endif -%}
        </div>
        <template>
          {{
            video_local
            | video_tag:
              autoplay: autoplay,
              alt: image_alt_default,
              controls: true,
              muted: muted,
              poster: poster,
              loop: loop,
              class: 'focus-inset'
          }}
          <span class="focus-video absolute inset-0 pointer-none"></span>
        </template>
        {{
          video_local
          | video_tag:
            autoplay: autoplay,
            controls: true,
            alt: image_alt_default,
            muted: muted,
            poster: poster,
            loop: loop,
            class: 'focus-inset'
        }}
        <span class="focus-video absolute inset-0 pointer-none"></span>
      {%- endif -%}
    </div>
  </video-local>
</div>
{% schema %}
{
  "name": "t:sections.video.name",
  "class": "multi-content__block--video w-full col-md-w-custom col-md-w-custom-50 switch-slide__mobile",
  "settings": [
    {
      "type": "video_url",
      "id": "video_url",
      "accept": ["youtube", "vimeo"],
      "label": "t:sections.video.settings.video_link.label",
      "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc"
    },
    {
      "type": "video",
      "id": "video_local",
      "label": "t:sections.video.settings.video_local.label",
      "info": "t:sections.video.settings.video_local.info_2"
    },
    {
      "type": "image_picker",
      "id": "cover_image",
      "label": "t:sections.video.settings.video_poster.label"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "t:sections.video.settings.autoplay.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "looping",
      "label": "t:sections.video.settings.looping.label",
      "default": false
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "options": [
        {
          "value": "16/9",
          "label": "t:sections.video.settings.aspect_ratio.option__1"
        },
        {
          "value": "21/9",
          "label": "t:sections.video.settings.aspect_ratio.option__2"
        },
        {
          "value": "adapt",
          "label": "t:sections.video.settings.aspect_ratio.option__3"
        }
      ],
      "default": "16/9",
      "label": "t:sections.video.settings.aspect_ratio.label"
    },
    {
      "type": "header",
      "content": "t:sections.multi_content.blocks.label"
    },
    {
      "type": "select",
      "id": "vertical_alignment",
      "options": [
        {
          "value": "start",
          "label": "t:sections.image-with-text.settings.desktop_vertical_alignment.top"
        },
        {
          "value": "center",
          "label": "t:sections.image-with-text.settings.desktop_vertical_alignment.middle"
        },
        {
          "value": "end",
          "label": "t:sections.image-with-text.settings.desktop_vertical_alignment.bottom"
        }
      ],
      "default": "start",
      "label": "t:sections.image-with-text.settings.vertical_alignment"
    },
    {
      "type": "select",
      "id": "width",
      "label": "t:sections.all.width.label",
      "default": "50%",
      "options": [
        {
          "value": "16.666%",
          "label": "t:sections.footer.settings.width.options__1"
        },
        {
          "value": "20%",
          "label": "t:sections.footer.settings.width.options__2"
        },
        {
          "value": "25%",
          "label": "t:sections.footer.settings.width.options__3"
        },
        {
          "value": "33.333%",
          "label": "t:sections.footer.settings.width.options__4"
        },
        {
          "value": "50%",
          "label": "t:sections.footer.settings.width.options__5"
        },
        {
          "value": "66.666%",
          "label": "t:sections.footer.settings.width.options__6"
        },
        {
          "value": "75%",
          "label": "t:sections.footer.settings.width.options__7"
        },
        {
          "value": "86%",
          "label": "t:sections.footer.settings.width.options__8"
        },
        {
          "value": "100%",
          "label": "t:sections.footer.settings.width.options__9"
        }
      ]
    }
  ],
  "presets": [{ "name": "t:sections.video.name" }]
}
{% endschema %}
